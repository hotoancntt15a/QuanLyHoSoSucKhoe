@{
    ViewBag.Title = $"Cập nhật tài khoản {Request["id"]}";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var item = ViewBag.data as trabaohiem_mssqlserver.Models.nguoidung;
    string lancuoi = item.lancuoi.HasValue ? item.lancuoi.Value.ToString("dd/MM/yyyy") : "";
}
<h2>@ViewBag.Title</h2>
<form method="post">
    <div class="form-group">
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Tài khoản:</div></div>
            <input type="text" name="taikhoan" maxlength="50" @Html.Raw(ViewBag.flagedit) class="form-control" value="@item.tendangnhap" />
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Mật khẩu:</div></div>
            <input type="text" name="matkhau" maxlength="50" placeholder="Điền mật khẩu nếu muốn cấp lại mật khẩu" class="form-control" value="" />
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Điện thoại:</div></div>
            <input type="text" name="sdt" class="form-control" value="@item.sdt" placeholder="Số điện thoại liên hệ" />
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Cấp độ</div></div>
            <select name="capdo" id="capdo" class="form-control">
                <option value="4">4 - Khách</option>
                <option value="3">3 - Xã</option>
                <option value="2">2 - Huyện</option>
                <option value="1">1 - Tỉnh</option>
                <option value="0">0 - [system]</option>
            </select>
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Kích hoạt</div></div>
            <select name="kichhoat" id="kichhoat" class="form-control">
                <option value="0">Không kích hoạt</option>
                <option value="1">kích hoạt</option>
            </select>
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Ghi chú:</div></div>
            <input type="text" name="ghichu" maxlength="255" class="form-control" value="@item.ghichu" />
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append">
                <div class="input-group-text">Tỉnh</div>
            </div>
            <select class="form-control" name="idtinh" id="idtinh" setid="idhuyen" onchange="loadoptiondiachinh('idtinh')">@Html.Raw(ViewBag.optiontinh)</select>
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append"><div class="input-group-text">Bảo hiểm thuộc:</div></div>
            <select name="bhhuyen" id="bhhuyen" class="form-control">@Html.Raw(ViewBag.optionbhhuyen)</select>
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append">
                <div class="input-group-text">Huyện</div>
            </div>
            <select class="form-control" name="idhuyen" id="idhuyen" setid="idxa" onchange="loadoptiondiachinh('idhuyen')">@Html.Raw(ViewBag.optionhuyen)</select>
        </div>
        <div class="input-group input-group-sm">
            <div class="input-group-append">
                <div class="input-group-text">Xã</div>
            </div>
            <select class="form-control" name="idxa" id="idxa" setid=""> @Html.Raw(ViewBag.optionxa) </select>
        </div>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary"> <i class="fa fa-save"></i> Lưu lại </button>
        <button type="reset" class="btn btn-primary"> <i class="fa fa-refresh"></i> Làm mới </button>
        <a href="@Url.Action("index")" class="btn btn-primary"> <i class="fa fa-backward"></i> Danh sách</a>
    </div>
</form>
@section scripts{
    <script>
        function loadoptiondiachinh(id1) {
            if (!id1.startsWith("#")) { id1 = '#' + id1; }
            if ($(id1).attr('setid') == '') { return; }
            var id2 = '#' + $(id1).attr('setid');
            $.get('@Url.Action("optiondiachinh", "tools", new { area = "" })/' + $(id1).val(),
                function (data) { $(id2).html(data); loadoptiondiachinh(id2); }).fail(function () {
                    $(id2).html('<option value="error">lỗi trong quá trình tuyền dữ liệu hoặc máy chủ không có phản hồi</option>');
                    loadoptiondiachinh(id2);
                });
            if (id1 == '#idtinh') {
                $.get('@Url.Action("optionscqbh", "tools", new { area = "" })/' + $(id1).val(),
                function (data) { $('#bhhuyen').html(data); }).fail(function () {
                    $(id2).html('<option value="error">lỗi trong quá trình tuyền dữ liệu hoặc máy chủ không có phản hồi</option>');
                });
            }
        }
        $(document).ready(function () {
            @if (Request["id"] == null) { Html.Raw("loadoptiondiachinh('idtinh');"); }
            $('#capdo').val('@item.capdo');
            $('#kichhoat').val('@item.kichhoat');
        });
    </script>
}